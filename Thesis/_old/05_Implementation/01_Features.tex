\section{Umsetzung der Parametereinlesung}
Wie in Kapitel \ref{sec:Config} bereits erwähnt, bekommt der Netzwerkmanager seine Parameter mittels \ac{JSON} File übermittelt. Dies muss im ersten Schritt ausgelesen werden, und den entsprechenden Variablen im System zugeordnet werden, um im Nachgang damit zu arbeiten. Hierzu wurden die Klassen \emph{json\_translator} und \emph{in\_car\_application} implementiert. Diese ermöglicht die Konvertierung der \ac{JSON}-Parameter in die benötigten Variablentypen, welche in der Klasse \emph{in\_car\_application} definiert sind. Der \emph{json\_translator} ist auch in der Lage zu erkennen ob eine Anwendung mehrere Nachrichten versenden will und berechnet die Gesamtbandbreite der Applikation. Dies ist wichtig, damit der Netzwerkmanager später entscheiden kann, ob noch genügend Bandbreite für die Applikation vorhanden ist. 
\newpage
In der Klasse \emph{http\_connector} ist die in Abschnitt \ref{sec:REST} erwähne Technologie zum hinzufügen einer neuen Applikation implementiert, wird die Methode zum  \emph{adden} (dt. hinzufügen) einer neuen Anwendung zum System aufgerufen, starte diese das Einlesen der Parameter über den \emph{json\_translator} und gibt als Rückgabewert ein  Objekt vom Typ \emph{InCarApplication} zurück. In dem Objekt sind alle im Applikationsmanifest definierten Parameter abgelegt und können im sog. Netzwerkstatus (Klasse \emph{netwerk\_flow}) jederzeit von andern Klassen abgefragt werden. Für den weiteren Verlauf der Arbeit kann davon ausgegangen werden, dass eine Applikation vollständig in einem Objekt der Klasse \emph{in\_car\_application} abgebildet ist. 

\singlefigureMax{\label{fig:ClassJson}}{99_Dias/ClassJsonParam.png}{Klassendiagramm Parametereinlesung}

Der bereits erwähnte Netzwerkstatus spiegelt den aktuelle Stand des Netzwerkes wieder. So sind dort beispielsweise Datenflüsse, Laufende Anwendungen und  einige weitere Parameter enthalten. Der Status kann somit jederzeit von verschiedensten Funktionen abgefragt werden. Der Zusammenhang zwischen den verschieden Klassen die für die Parametereinlesung verantwortlich sind, ist im Klassendiagramm Abb. \ref{fig:ClassJson} dargestellt. Aufrufe von außen, wie beispielsweise durch den Orchestrator, erfolgen über den \emph{http\_connector}.



\section{Umsetzung der Parameterauswertung mittels Feature}\label{sec:Auswertung}
Nachdem die Parameter in den entsprechenden Variablen hinterlegt wurden, beginnt der Netzwerkmanager nacheinander die Features aus Abschnitt \ref{sec:FeatureDef} abzuarbeiten. Diese liefern die gewünschten Konfigurationsbefehle für den Switch in Form einer Befehlsliste zurück. Im Testfall Ingress Filtering wird mit dem Feature zum Aufbau der Kommunikationsstrecke begonnen. Dazu werden die vom Orchestrator übergeben \ac{ECU}'s als Start- und Endknoten verwendet. Die Kommunikationsstrecke über die Daten der Applikation übermittelt werden, wird als Flow oder Datenflow bezeichnet. In einem Flow sind die sendende und empfangende Applikation als Anfang- und Endpunkt abgespeichert, anhand dieser kann später eine zuordnen zwischen Applikation, Kommunikationspartnern und Datenflow erfolgen. Mithilfe der Klasse \emph{simple\_path\_resolution} werden mögliche Pfade zwischen den Endpunkten gesucht. Ist ein geeigneter Pfad für einen Flow gefunden, werden beide in einer Map mit \emph{Key-Value Pairs} abgelegt. So kann ein Pfad eindeutig einer Datenflow zugeordnet werden. 

Ein Pfad kann aus mehren Edges bestehen, welche wiederum eine Teilstrecke eins Pfades darstellt. Eine Edge entspricht einem Hop laut Netzwerkdefinition, d. h. dem Weg zwischen zwei Netzwerkgeräten. Edge sind notwendig, da ein Pfad nur Anfang- und Endgerät kennt, jedoch nicht alle Teilnehmer die ein Datenpaket beim Versenden passieren muss. Eine Edge hat ebenfalls eine Start- und Endkonten, diese werden im System als Nodes bezeichnet.

Nodes sind nichts anders als Geräte im Netzwerk wie beispielsweise ein Switch. In einem Node besitzen Attribute wie \ac{MAC}-Adresse, Ports und einem \emph{Key-Value Pair}, welches eine Verbindung zwischen Ports und Node herstellt. Dieses Mapping ist notwendig um später, in der Verarbeitung der Features, alle dem Pfad zugehörigen Nodes den entsprechenden Ein- und Ausgangsport zuordnen zu können, da ein Node in der Regel nicht nur einen, sondern mehrere Ports besitzt. 

Um die Zusammenhänge der einzelnen Klassen zu verdeutlichen, wurde in Abb. \ref{fig:network} ein Klassenmodel erstellt. Diese enthält in den einzelnen Komponenten lediglich die für die Arbeit relevanten Variablen und Funktionen.

\singlefigurePlus{\label{fig:network}}{99_Dias/ClassNetwork.png}{Klassendiagramm Netzwerkübersicht}

\newpage

Sobald die Pfadfindung abgeschlossen ist, werden aus der Klasse \newline\emph{feature\_based\_configuration\_resolution} heraus, nacheinander die einzelnen Features aus Kapitel \ref{sec:FeatureDef} aufgerufen. So wird das Feature Kommunikation, welches Ingress Filtering beinhaltet und in der Klasse \newline \emph{feature\_communication\_ingress\_filtering} implementiert ist, ebenfalls hier durchlaufen. Dieses sucht, mittels der übergebenen Applikation, dem Flow-Pfad Mapping und dem aktuellen Netzwerkstatus den zugehörigen Pfad für die Anwendung. Ist dieser gefunden, wird über alle Edges des Pfades iteriert und für alle Nodes auf Empfängerseite die entsprechenden Portregelungen für das Ingress Filtering in der in Abschnitt \ref{sec:ConfigEndgerät} erwähnten Liste mit Instruktion abgelegt. Sobald alle Edges durchlaufen sind, gilt das Feature als abgearbeitet und es kann mit dem nächsten Feature begonnen werden. Sind alle abgearbeitet wird die Instruktion Liste an die Schnittstelle zur Konfiguration der Endgeräten übergeben. Dies konfiguriert mit den entsprechenden Funktionen, aus der erwähnten Library, das Endgerät. Im Fall Ingress Filtering werden die Portregelungen, wie Filtereigenschaften für Datenpakete, mit den entsprechenden Ein- und Ausgangsadressen der Netzwerkgeräte, übermittelt.


%\singlefigureMax{\label{fig:ClassSwitch}}{99_Dias/SwitchConfig.png}{Klassendiagramm Switch-Konfiguration}

\subsection{Testing der Implementation Ingress Filtering}
Um sicher zu stellen das das Konzept der Features, zur automatischen Konfiguration, richtig arbeitet, müssen alle Teilelemente der Implementation mittel Unittests überprüft werden. Hierzu wurde zuerst eine Testklasse zu Parameter-Einlesung geschrieben, welche der Klasse \emph{json\_translator} ein Manifest im \ac{JSON} Format übergibt und die zurückgegebenen Ist-Werte mit den zuvor definierten Soll-Werten vergleicht. Dies soll sicherstellen das alle Parameter aus den Manifest in den richtigen Variablen des Netzwerkmanager landen. 

Die zweit Testklasse ist speziell für den Testfall Ingress Filtering implementiert. Es besitzt ein zuvor definierte Netzwerktopologie mit drei Netzwerkknoten. Anhand dieser wird der in Abschnitt \ref{sec:Auswertung} Prozess durchlaufen. Nach der Abbildung der Topologie in der Software, mittels Flows, Pfaden und Edges, wird die automatisierte Portregelungs-Konfiguration in der Klasse \emph{feature\_communication\_ingress\_filtering} angestoßen. Nach dem vollständigen Durchlauf des Features, wird die erstellte Instruktionsliste mit der erwarteten Ergebnis verglichen.

Beide Test konnten positiv bewertet werden, was sicherstellt das, das Konzept der automatischen Netzwerkkonfiguration auf diese Weise umsetzbar ist. Ein nächster Schritt ist es die Konfiguration auf eine realen Switch weiter zu leiten, um auch Hardwareseitig noch einige Tests durchführen zu können. Dies ist jedoch nicht mehr Teil dieser Arbeit, wird aber bereits im Projekt A3F weiter verfolgt.